---
name: impl-start
description: |
  impl-planで作成した実装プランを読み込み、Phase単位で実装を進める。
  「/impl-start」「実装を開始」「プランに従って実装」などの要求時に使用。
  プランファイルのパスまたはPhase番号を引数で指定できる。
argument-hint: "[プランファイルパス] [Phase番号 (optional)]"
user-invocable: true
allowed-tools: Read, Write, Edit, Glob, Grep, Bash(ls *), Bash(test *), Bash(git *), Bash(mkdir *), Bash(npm *), Bash(npx *), Bash(gradle *), Bash(./gradlew *)
---

# 実装開始スキル

impl-planで作成したプランを読み込み、Phase単位で実装を進めるスキル。

## 実行フロー

### Step 1: プランファイルの特定

引数にプランファイルパスが指定されている場合はそれを使用する。

**指定がない場合:**
`~/.claude/plans/` 内の最新のプランファイルを一覧表示して、ユーザーに選択してもらう。

```bash
ls -t ~/.claude/plans/*.md
```

ファイルが存在しない場合は以下を出力して中断:

```
プランファイルが見つかりません。
先に /impl-plan でプランを作成してください。
```

### Step 2: プランの読み込みと状態確認

プランファイルを読み込み、以下を確認する:

1. **確認事項セクション**のチェックボックスを確認
   - 未チェック（`- [ ]`）の項目がある場合、ユーザーに提示して回答を求める
   - すべてチェック済みであれば次のステップへ進む

2. **ステータス**を確認
   - `Draft` → 実装開始前。ステータスを `In Progress` に更新する
   - `In Progress` → 途中から再開。完了済みPhaseを特定する

### Step 3: Phase選択

引数にPhase番号が指定されている場合はそのPhaseから開始する。

**指定がない場合:**
プランの「実装ステップ」セクションからPhase一覧を抽出して提示する。

```
プラン: ユーザー認証機能の実装

Phase 1: 認証基盤の構築        [未着手]
Phase 2: 認証エンドポイントの実装 [未着手]
Phase 3: フロントエンド対応      [未着手]

どのPhaseから実装を開始しますか？
```

### Step 4: 実装の実行

選択されたPhaseの内容に従って実装を進める。

**実装時のルール:**
- プランの各ステップを TodoList（TaskCreate）に登録する
- 各タスクを `in_progress` → `completed` と更新しながら進める
- プロジェクトの coding-general.md と coding-ddd.md のルールに従う
- 影響範囲セクションに記載されたファイルを優先的に確認・編集する

**並行実行の活用:**
- Phase内の独立したステップは並行して実行する
- 実装が一区切りついたら、code-reviewer エージェントをバックグラウンドで起動して品質チェックを依頼する

### Step 5: Phase完了時のレビュー

Phase内の全ステップが完了したら、以下の2つのエージェントを**同時にバックグラウンドで起動**する:

#### code-reviewer エージェント（コード品質）
- コーディングルール・DDD準拠のチェック
- セキュリティ・パフォーマンスの検証

#### qa-reviewer エージェント（テスト品質）
- テスト網羅性の検証（正常系・異常系・境界値）
- 不足しているテストケースの特定
- テスト品質（命名・アサーション・独立性）の検証

**ユーザーへの案内:**

```
Phase {N} の実装が完了しました。

バックグラウンドでレビュー中です:
  - code-reviewer: コード品質チェック
  - qa-reviewer: テスト網羅性チェック
```

### Step 6: レビュー結果の対応

両エージェントの結果を統合して報告する。

1. CRITICAL・HIGHの指摘があれば修正する
2. テスト追加が必要な場合は追加する
3. プランファイルのPhaseにチェックマークを付ける
   - `### Phase 1: 認証基盤の構築` → `### Phase 1: 認証基盤の構築 [完了]`
4. 次のPhaseの有無を確認し、続行するか確認する

### Step 7: 全Phase完了

すべてのPhaseが完了したら:

1. プランファイルのステータスを `Completed` に更新する
2. 変更の概要を報告する
3. 必要に応じて `/pr-create` でPR作成を提案する

---

## 複数セッションでの並行開発

独立したPhaseを別々のターミナルで同時実行する場合:

```
# Terminal 1
/impl-start [プランファイル] 1

# Terminal 2
/impl-start [プランファイル] 3
```

**並行可能の条件:**
- 「影響範囲 > 変更対象ファイル」が重複していないこと
- Phase間に依存関係がないこと（Phase 2がPhase 1の成果物を前提としていないこと）

並行不可と判断した場合はユーザーに警告する:

```
Phase 2 は Phase 1 の成果物に依存しています。
Phase 1 の完了後に実行してください。

依存関係:
- Phase 1 で作成する `src/middleware/auth.ts` を Phase 2 が使用
```

---

## 注意事項

- プランに記載のない変更は行わない。追加が必要な場合はユーザーに確認する
- 大きな設計判断が必要な場合は architect エージェントに分析を委譲する
- 実装中にプランの不備を発見した場合はプランファイルにコメントを追記する
